<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8">
    <title>감다살 THANKS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      :root { color-scheme: light dark; }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        min-height: 100vh;
        font-family: 'Pretendard', 'Apple SD Gothic Neo', 'Segoe UI', sans-serif;
        color: #f6f4ff;
        background: radial-gradient(circle at 20% 20%, #060210 0%, #1d1144 45%, #02000a 100%);
        display: flex;
        justify-content: center;
        padding: clamp(2rem, 5vw, 3.6rem) clamp(1.6rem, 4vw, 3rem);
      }
      main {
        width: min(820px, 100%);
        display: grid;
        gap: clamp(2rem, 5vw, 3rem);
        background: rgba(20, 14, 44, 0.84);
        border-radius: clamp(2rem, 4vw, 3rem);
        padding: clamp(2.6rem, 5vw, 3.6rem);
        box-shadow: 0 3.5rem 5.5rem rgba(0, 0, 0, 0.55), inset 0 0 0 1px rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(18px);
      }
      header { text-align: center; display: grid; gap: 0.8rem; }
      header h1 { margin: 0; font-size: clamp(2.4rem, 6vw, 3.3rem); letter-spacing: 0.05em; }
      header p { margin: 0; color: rgba(255, 255, 255, 0.76); font-size: 1.05rem; }
      section { display: grid; gap: 1.2rem; }
      .section-title { margin: 0; font-size: 1rem; letter-spacing: 0.18em; text-transform: uppercase; color: rgba(255, 255, 255, 0.7); }
      .upload-list { display: grid; gap: 1rem; }
      .upload-item {
        display: flex;
        gap: 1.2rem;
        flex-wrap: wrap;
        align-items: center;
        padding: 1rem 1.2rem;
        border-radius: 1.4rem;
        background: rgba(255, 255, 255, 0.08);
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.12);
      }
      .upload-video {
        flex: 0 0 200px;
        max-width: 240px;
        border-radius: 1.2rem;
        overflow: hidden;
        box-shadow: 0 1.1rem 2.2rem rgba(0, 0, 0, 0.45);
      }
      .upload-video video {
        display: block;
        width: 100%;
        height: 100%;
        object-fit: cover;
        background: rgba(0, 0, 0, 0.3);
      }
      .upload-info { flex: 1 1 220px; text-align: left; }
      .upload-info strong { display: block; font-size: 1.05rem; color: #ffe7f8; }
      .upload-info span { font-size: 0.92rem; color: rgba(255, 255, 255, 0.7); }
      .upload-actions { display: flex; gap: 0.6rem; align-items: center; }
      .upload-actions button {
        border: none;
        border-radius: 999px;
        padding: 0.5rem 0.95rem;
        font-size: 0.85rem;
        font-weight: 600;
        background: rgba(255, 255, 255, 0.18);
        color: rgba(24, 20, 54, 0.9);
        cursor: pointer;
        transition: filter 0.15s ease;
      }
      .upload-actions button:hover { filter: brightness(1.08); }
      .upload-empty {
        margin: 0;
        padding: 1rem 1.2rem;
        border-radius: 1.2rem;
        background: rgba(255, 255, 255, 0.06);
        color: rgba(255, 255, 255, 0.65);
      }
      form {
        display: grid;
        gap: 1rem;
        padding: 1.6rem 1.8rem;
        border-radius: 1.8rem;
        background: rgba(255, 255, 255, 0.07);
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.08);
      }
      form label { text-align: left; font-size: 0.95rem; color: rgba(255, 255, 255, 0.78); }
      input[type="text"] {
        width: 100%;
        border: none;
        border-radius: 1rem;
        padding: 0.9rem 1rem;
        font-size: 1rem;
        background: rgba(255, 255, 255, 0.12);
        color: #fff;
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.1);
      }
      input::placeholder { color: rgba(255, 255, 255, 0.55); }
      input:focus { outline: 2px solid rgba(255, 255, 255, 0.3); }
      .dropzone {
        position: relative;
        border: 2px dashed rgba(255, 255, 255, 0.22);
        border-radius: 1.6rem;
        padding: 1.6rem 1.4rem;
        text-align: center;
        color: rgba(255, 255, 255, 0.74);
        display: grid;
        gap: 0.7rem;
        background: rgba(255, 255, 255, 0.06);
        transition: border-color 0.2s ease, background 0.2s ease;
      }
      .dropzone.hover { border-color: #fad0c4; background: rgba(255, 255, 255, 0.12); }
      .dropzone.has-file { border-color: rgba(255, 255, 255, 0.4); background: rgba(255, 255, 255, 0.12); }
      .dropzone.uploading { border-color: rgba(255, 154, 158, 0.6); background: rgba(255, 154, 158, 0.18); }
      .dropzone input { display: none; }
      .dropzone-status { font-size: 0.92rem; color: rgba(255, 255, 255, 0.75); }
      .select-button {
        justify-self: center;
        border: none;
        border-radius: 999px;
        padding: 0.6rem 1.3rem;
        font-size: 0.9rem;
        font-weight: 600;
        background: rgba(255, 255, 255, 0.16);
        color: rgba(26, 22, 60, 0.9);
        cursor: pointer;
        transition: filter 0.15s ease;
      }
      .select-button:hover { filter: brightness(1.1); }
      .upload-hint { margin: 0; font-size: 0.85rem; color: rgba(255, 255, 255, 0.6); text-align: left; }
      form button[type="submit"] {
        justify-self: flex-end;
        border: none;
        border-radius: 999px;
        padding: 0.85rem 1.9rem;
        font-size: 0.96rem;
        font-weight: 600;
        letter-spacing: 0.05em;
        background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
        color: #341d2f;
        cursor: pointer;
        box-shadow: 0 1.3rem 2.4rem rgba(255, 154, 158, 0.34);
      }
      form button[type="submit"]:hover { filter: brightness(1.05); }
      form button[type="submit"]:disabled { opacity: 0.55; cursor: default; filter: none; }
      @media (max-width: 640px) {
        body { padding: 1.6rem 1.1rem 2.4rem; }
        main { padding: 2rem 1.4rem 2.6rem; }
        .upload-item { padding: 0.9rem; }
        .upload-video { flex: 1 1 100%; max-width: none; }
        .upload-actions { width: 100%; justify-content: flex-end; }
        form { padding: 1.4rem 1.5rem; }
      }
    </style>
  </head>
  <body>
    <main>
      <header>
        <h1>감다살 THANKS</h1>
        <p>감사와 간증 영상을 모아 감다살 THANKS 시간을 나눠요.</p>
      </header>

      <section aria-labelledby="upload-list-title">
        <h2 id="upload-list-title" class="section-title">최근 영상</h2>
        <div id="upload-list" class="upload-list"></div>
      </section>

      <section aria-labelledby="upload-form-title">
        <h2 id="upload-form-title" class="section-title">영상 업로드</h2>
        <form id="upload-form" autocomplete="off">
          <label for="upload-title">영상 제목</label>
          <input id="upload-title" type="text" maxlength="80" placeholder="예: 이하연셀 감사 간증" required>
          <div class="dropzone" id="upload-dropzone">
            <strong>영상 파일을 끌어다 놓거나 아래 버튼으로 선택하세요.</strong>
            <span class="dropzone-status" id="dropzone-status">선택된 파일이 없습니다.</span>
            <button type="button" id="upload-select" class="select-button">파일 선택</button>
            <input id="upload-file" type="file" accept="video/*">
          </div>
          <small class="upload-hint">file.io로 업로드되며, 생성된 링크는 1회 다운로드 또는 1주 후 만료됩니다.</small>
          <button type="submit" id="upload-submit">업로드</button>
        </form>
      </section>
    </main>

    <script>
      const DEFAULT_UPLOADS = [
        { title: '이하연셀 정요한 — 감사 간증', subtitle: '2025-10-18 · 1분 02초', src: 'https://samplelib.com/lib/preview/mp4/sample-5s.mp4', poster: 'https://dummyimage.com/320x180/1b2245/ffffff&text=%EA%B0%95%EC%9D%8C+THANKS' },
        { title: '이하연셀 이하연 — THANKS 찬양', subtitle: '2025-10-17 · 55초', src: 'https://samplelib.com/lib/preview/mp4/sample-10s.mp4', poster: 'https://dummyimage.com/320x180/2a2860/ffffff&text=%EC%9D%B4%ED%95%98%EC%97%B0+THANKS' },
        { title: '이하연셀 강민욱 — 감사 브이로그', subtitle: '2025-10-16 · 1분 10초', src: 'https://samplelib.com/lib/preview/mp4/sample-12s.mp4', poster: 'https://dummyimage.com/320x180/2f2d6b/ffffff&text=%EA%B0%95%EB%AF%BC%EC%9A%B1+VLOG' },
        { title: '이하연셀 — THANKS 나눔', subtitle: '2025-10-15 · 1분 28초', src: 'https://samplelib.com/lib/preview/mp4/sample-15s.mp4', poster: 'https://dummyimage.com/320x180/202759/ffffff&text=THANKS+%EB%82%98%EB%88%94' },
        { title: '이하연셀 — 감사 카드 만들기', subtitle: '2025-10-14 · 1분 36초', src: 'https://samplelib.com/lib/preview/mp4/sample-20s.mp4', poster: 'https://dummyimage.com/320x180/1d285f/ffffff&text=%EA%B0%90%EC%82%AC+%EC%B9%B4%EB%93%9C' },
        { title: '이하연셀 — 축복 기도 모임', subtitle: '2025-10-13 · 1분 50초', src: 'https://samplelib.com/lib/preview/mp4/sample-30s.mp4', poster: 'https://dummyimage.com/320x180/222a68/ffffff&text=%EC%B6%95%EB%B3%B5+%EA%B8%B0%EB%8F%84' },
        { title: '이하연셀 — 간증 인터뷰', subtitle: '2025-10-12 · 2분 05초', src: 'https://samplelib.com/lib/preview/mp4/sample-40s.mp4', poster: 'https://dummyimage.com/320x180/232c72/ffffff&text=%EA%B0%84%EC%A6%9D+Interview' },
        { title: '이하연셀 — THANKS 워십', subtitle: '2025-10-11 · 2분 20초', src: 'https://samplelib.com/lib/preview/mp4/sample-50s.mp4', poster: 'https://dummyimage.com/320x180/27307d/ffffff&text=THANKS+Worship' },
        { title: '이하연셀 — 감사 릴레이', subtitle: '2025-10-10 · 2분 35초', src: 'https://samplelib.com/lib/preview/mp4/sample-100s.mp4', poster: 'https://dummyimage.com/320x180/2c3385/ffffff&text=%EA%B0%90%EC%82%AC+Relay' },
        { title: '이하연셀 — THANKS 하이라이트', subtitle: '2025-10-09 · 2분 50초', src: 'https://samplelib.com/lib/preview/mp4/sample-150s.mp4', poster: 'https://dummyimage.com/320x180/30378f/ffffff&text=THANKS+Highlight' }
      ];
      const STORAGE_KEY = 'gamdasal-thanks-uploads';
      const STORAGE_VERSION = '2025-10-24';

      const uploadList = document.getElementById('upload-list');
      const uploadForm = document.getElementById('upload-form');
      const titleInput = document.getElementById('upload-title');
      const dropzone = document.getElementById('upload-dropzone');
      const fileInput = document.getElementById('upload-file');
      const selectButton = document.getElementById('upload-select');
      const dropzoneStatus = document.getElementById('dropzone-status');
      const submitButton = document.getElementById('upload-submit');

      let uploads = [];
      let selectedFile = null;

      const fallbackPoster = (title) => {
        const safe = encodeURIComponent((title || 'Thanks').slice(0, 18));
        return `https://dummyimage.com/320x180/1d285f/ffffff&text=${safe}`;
      };
      const formatNow = () => {
        const now = new Date();
        const pad = (value) => String(value).padStart(2, '0');
        return `${now.getFullYear()}-${pad(now.getMonth() + 1)}-${pad(now.getDate())} · ${pad(now.getHours())}:${pad(now.getMinutes())}`;
      };
      const persistUploads = () => {
        try {
          const payload = { version: STORAGE_VERSION, data: uploads };
          localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
        } catch (error) {
          console.error('업로드 저장 실패', error);
        }
      };
      const renderUploads = () => {
        uploadList.innerHTML = '';
        if (!uploads.length) {
          const empty = document.createElement('p');
          empty.className = 'upload-empty';
          empty.textContent = '등록된 THANKS 영상이 아직 없습니다. 위 양식으로 감사를 공유해 보세요.';
          uploadList.append(empty);
          return;
        }
        uploads.forEach((item, index) => {
          const article = document.createElement('article');
          article.className = 'upload-item';
          const videoWrap = document.createElement('div');
          videoWrap.className = 'upload-video';
          const video = document.createElement('video');
          video.controls = true;
          video.preload = 'metadata';
          video.src = item.src;
          video.poster = item.poster;
          videoWrap.append(video);
          const info = document.createElement('div');
          info.className = 'upload-info';
          const title = document.createElement('strong');
          title.textContent = item.title;
          const subtitle = document.createElement('span');
          subtitle.textContent = item.subtitle;
          info.append(title, subtitle);
          const actions = document.createElement('div');
          actions.className = 'upload-actions';
          const removeBtn = document.createElement('button');
          removeBtn.type = 'button';
          removeBtn.textContent = '삭제';
          removeBtn.dataset.remove = String(index);
          actions.append(removeBtn);
          article.append(videoWrap, info, actions);
          uploadList.append(article);
        });
      };
      const resetSelectedFile = () => {
        selectedFile = null;
        dropzone.classList.remove('has-file', 'uploading');
        dropzoneStatus.textContent = '선택된 파일이 없습니다.';
      };
      const setSelectedFile = (file) => {
        if (!file) return;
        if (!file.type.startsWith('video/')) {
          alert('영상 파일만 업로드할 수 있습니다.');
          return;
        }
        selectedFile = file;
        dropzone.classList.add('has-file');
        dropzoneStatus.textContent = `${file.name} (${(file.size / 1024 / 1024).toFixed(1)}MB)`;
      };
      const uploadToFileIO = async (file) => {
        dropzone.classList.add('uploading');
        dropzoneStatus.textContent = '업로드 중입니다…';
        submitButton.disabled = true;
        const formData = new FormData();
        formData.append('file', file);
        try {
          const response = await fetch('https://file.io/?json=true&expires=1w', {
            method: 'POST',
            body: formData,
          });
          if (!response.ok) {
            throw new Error('HTTP ' + response.status);
          }
          const result = await response.json();
          if (!result.success) {
            throw new Error(result.message || '업로드 실패');
          }
          return result.link;
        } finally {
          dropzone.classList.remove('uploading');
          submitButton.disabled = false;
        }
      };
      const seedUploads = () => {
        try {
          const storedRaw = JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null');
          let storedData = [];
          if (storedRaw && Array.isArray(storedRaw.data)) {
            storedData = storedRaw.data;
          } else if (Array.isArray(storedRaw)) {
            storedData = storedRaw;
          }
          if (!storedData.length || storedData.length < DEFAULT_UPLOADS.length || storedRaw?.version !== STORAGE_VERSION) {
            uploads = [...DEFAULT_UPLOADS];
            persistUploads();
          } else {
            uploads = storedData;
          }
        } catch (error) {
          uploads = [...DEFAULT_UPLOADS];
          persistUploads();
        }
        renderUploads();
      };
      uploadList.addEventListener('click', (event) => {
        const target = event.target.closest('button[data-remove]');
        if (!target) return;
        const index = Number(target.dataset.remove);
        if (Number.isNaN(index)) return;
        const confirmRemove = window.confirm('이 THANKS 영상을 삭제할까요?');
        if (!confirmRemove) return;
        uploads.splice(index, 1);
        persistUploads();
        renderUploads();
      });
      selectButton.addEventListener('click', () => fileInput.click());
      fileInput.addEventListener('change', (event) => {
        setSelectedFile(event.target.files?.[0]);
        fileInput.value = '';
      });
      ['dragenter', 'dragover'].forEach((type) => {
        dropzone.addEventListener(type, (event) => {
          event.preventDefault();
          dropzone.classList.add('hover');
        });
      });
      ['dragleave', 'drop'].forEach((type) => {
        dropzone.addEventListener(type, (event) => {
          event.preventDefault();
          dropzone.classList.remove('hover');
        });
      });
      dropzone.addEventListener('drop', (event) => {
        setSelectedFile(event.dataTransfer.files?.[0]);
      });
      uploadForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        const title = titleInput.value.trim();
        if (!title) {
          alert('영상 제목을 입력해주세요.');
          return;
        }
        if (!selectedFile) {
          alert('업로드할 영상 파일을 선택해주세요.');
          return;
        }
        try {
          const link = await uploadToFileIO(selectedFile);
          const newItem = {
            title,
            subtitle: formatNow(),
            src: link,
            poster: fallbackPoster(title)
          };
          uploads.unshift(newItem);
          uploads = uploads.slice(0, 12);
          persistUploads();
          renderUploads();
          uploadForm.reset();
          resetSelectedFile();
          alert('업로드가 완료되었습니다. THANKS 목록에서 바로 재생할 수 있어요.');
        } catch (error) {
          console.error(error);
          alert('업로드에 실패했습니다. 잠시 후 다시 시도해주세요.');
        }
      });
      seedUploads();
    </script>
  </body>
</html>
